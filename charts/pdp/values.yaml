# Feature flag added to preserve backward compatibility with the old naming conventions
# When useStandardHelmNamingConventions is false (default):
# - Service name: permitio-pdp
# - Secret name: permitio-pdp-secret
# - Deployment name: permitio-pdp
# - PodDisruptionBudget name: permitio-pdp-pdb
#
# When useStandardHelmNamingConventions is true:
# - Service name: {release-name}-{chart-name} (e.g., my-release-pdp)
# - Secret name: {release-name}-{chart-name} (e.g., my-release-pdp)
# - Deployment name: {release-name}-{chart-name} (e.g., my-release-pdp)
# - PodDisruptionBudget name: {release-name}-{chart-name} (e.g., my-release-pdp)
#
# The standard Helm naming convention follows the pattern {release-name}-{chart-name}
# and automatically truncates names to 63 characters to comply with Kubernetes DNS naming spec.
useStandardHelmNamingConventions: false

labels: {}
annotations: {}

nameOverride: ""
fullnameOverride: ""

pdp:
  pdpEnvs:
    []
    # - name: custom_env
    #   value: "custom_env"
    #
    # Example - enable Envoy gRPC ext_authz on port 9191 (requires PDP >= 0.9.10):
    # - name: PDP_OPA_PLUGINS
    #   value: '{"permit_graph":{},"envoy_ext_authz_grpc":{"addr":":9191","path":"permit/root"}}'
  ApiKey: "<your PDP API Key>"

  # Use an existing secret for the API key instead of creating one
  # If defined, the chart will not create a secret and will use this existing secret
  # existingApiKeySecret:
  #   name: "my-existing-secret"
  #   key: "api-key"
  port: 7766
  # Example - expose Envoy gRPC ext_authz port (requires PDP_OPA_PLUGINS env var above):
  #   additionalPorts:
  #     - name: grpc
  #       port: 9191
  #       targetPort: 9191
  additionalPorts: []
  replicas: 1
  image:
    repository: permitio/pdp-v2
    tag: latest
    pullPolicy: Always
  logs_forwarder:
    enabled: false
    debug_mode: false
    type: "stdout" # 'stdout' or 'elasticsearch'
    # Log rotation settings (only applies when enabled=true)
    rotation: "250 MB"  # File size threshold for rotation
    retention: "3 days"  # How long to keep rotated log files
    elasticsearch:
      host: "<elasticsearch host>"
      cloud_auth: "<{user}:{password}>"
      port: 443
      index: "<elasticsearch index>"
  debug_mode: false

podDisruptionBudget:
  # Automatically enabled when replicas > 1
  # Set minAvailable OR maxUnavailable (not both)
  minAvailable: 1
  # maxUnavailable: 1

resources:
  requests:
    cpu: "256m"
    memory: "512Mi"
  limits:
    memory: "1Gi"

# OpenShift configuration
openshift:
  enabled: false # Set to true for OpenShift deployments
  serviceAccount:
    create: true
    name: "permitio-pdp-sa"
    sccName: "restricted-v2" # OpenShift Security Context Constraint
  # Security context (SCC will override user/group settings automatically)
  securityContext:
    runAsNonRoot: true
    runAsUser: 1001
    runAsGroup: 1001
    fsGroup: 1001
